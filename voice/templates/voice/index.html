{% extends "voice/layout.html" %}
{% load feature_extras %}

{% block header %}
<h1>Feature Requests</h1>
{% endblock %}

{% block main %}

{% if messages %}
    {% for message in messages %}
    <div class="alert-message block-message success fade in" data-alert="alert">
        <a class="close" href="#">×</a>
        <p><strong>Success!</strong> {{ message }}</p>
        <div class="alert-actions">
          <a class="btn small" href="#">Share with friends</a>
        </div>
    </div>
    {% endfor %}
{% endif %}

{% if vote_form.errors %}
<div class="alert-message block-message error fade in" data-alert="alert">
    <a class="close" href="#">×</a>
    <p><strong>Whoops!</strong> Looks like there was a problem voting.</p>
    <ul class='padded'>
        {% for field in vote_form %}
            {% for error in field.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        {% endfor %}
    </ul>
    {% if vote_form.voter.errors %}
    <form action="{% url voice-index %}" method='POST'>
        {% csrf_token %}
        <input id="id_feature" name="feature" value="{{ feature_id }}" type="hidden">
        {{ vote_form.voter }}
        <div class="alert-actions">
            <input type='submit' class="btn primary small" value='Try Again' />
            <a class="btn small" href="#">Dismiss</a>
        </div>
    </form>
    {% endif %}
</div>
{% endif %}

{% for group in grouped_features %}

<div class='row'>

    {% for feature in group %}

    <div class='span4'>
        <div class='feature'>
            <h3>{{ feature.title }}</h3>
            <p>{{ feature.description }}</p>
        </div>
        {% if feature|votes_left > 0 %}
            <h6>{{ feature|votes_left }} votes needed</h6>
            <a class='btn' data-controls-modal="vote-for-{{ feature.id }}" data-backdrop="true" data-keyboard="true" class="btn danger">
                Submit a vote
            </a>
        {% else %}
            <h6>Status: {{ feature|state }}</h6>
        {% endif %}
    </div>

    <div id="vote-for-{{ feature.id }}" class="modal hide fade">
          <form action="{% url voice-index %}" method='POST'>
              {% csrf_token %}
              <div class="modal-header">
                <a href="#" class="close">×</a>
                <h3>Submit a vote for {{ feature.title }}</h3>
              </div>
              <div class="modal-body">
                    {{ vote_form.voter.errors }}
                    <fieldset>
                        <div class="clearfix">
                            <label for="id_voter">Email:</label>
                            <input id="id_feature" name="feature" value="{{ feature.id }}" type="hidden">
                            <div class="input">
                                {{ vote_form.voter }}
                            </div>
                        </div><!-- /clearfix -->
                    </fieldset>
              </div>
              <div id='inside-form' class="modal-footer">
                  <input type='submit' class="btn primary" value='Submit Vote' />
              </div>
        </form>
    </div>

    {% endfor %}

</div>

{% if not forloop.last %}
<hr>
{% endif %}

{% endfor %}

{% endblock %}

{% block footer %}
<div class="modal-backdrop hide fade in"></div>
{% endblock %}
